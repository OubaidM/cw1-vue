<!-- index.html  –  Vue 3  –  after-school lessons front-end -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>After-School Classes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- CDN assets -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <!-- Vue mount point -->
  <div id="app">
    <div class="container py-4">

      <!-- page title + Cart / Store toggle -->
      <h1>After-School Lessons</h1>
      <div class="row mb-3">
        <div class="col d-flex justify-content-end">
          <button class="btn btn-outline-primary btn-sm"
                  :disabled="cart.length === 0 && currentPage==='lessons'"
                  @click="switchPage(currentPage === 'cart' ? 'lessons' : 'cart')">
            <i class="fa-solid fa-cart-shopping"></i>
            {{ currentPage === 'cart' ? 'Store' : 'Cart' }}
            <span class="badge bg-danger ms-1">{{ cart.length }}</span>
          </button>
        </div>
      </div>

      <!-- search box (lessons page only) -->
      <div class="row mb-2" v-if="currentPage === 'lessons'">
        <div class="col">
          <input class="form-control form-control-sm w-50"
                 placeholder="Search lessons…"
                 v-model="searchText"
                 @input="onSearch">
        </div>
      </div>

      <!-- sort bar (lessons page only) -->
      <div class="row mb-3" v-if="currentPage==='lessons'">
        <div class="col">
          <label class="me-2"><strong>Sort by:</strong></label>
          <div class="btn-group btn-group-sm" role="group">
            <button class="btn btn-outline-primary"
                    :class="{active: sortBy==='topic'}"
                    @click="setSort('topic')">Subject</button>
            <button class="btn btn-outline-primary"
                    :class="{active: sortBy==='location'}"
                    @click="setSort('location')">Location</button>
            <button class="btn btn-outline-primary"
                    :class="{active: sortBy==='price'}"
                    @click="setSort('price')">Price</button>
            <button class="btn btn-outline-primary"
                    :class="{active: sortBy==='space'}"
                    @click="setSort('space')">Spaces</button>
          </div>
          <!-- asc / desc toggle -->
          <button class="btn btn-sm btn-outline-secondary ms-3"
                  @click="ascending = !ascending">
            <i :class="ascending ? 'fa-solid fa-arrow-up-wide-short' : 'fa-solid fa-arrow-down-short-wide'"></i>
            {{ ascending ? 'Asc' : 'Desc' }}
          </button>
        </div>
      </div>

      <!-- LESSON LIST  (only when on lessons page) -->
      <div v-if="currentPage === 'lessons'" class="row">
        <div class="col-md-6 col-lg-4 mb-4"
             v-for="lesson in (searchText ? searchResults : sortedLessons())"
             :key="lesson._id">
          <div class="card h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title"><i class="fa-solid fa-book"></i> {{ lesson.topic }}</h5>
              <p class="card-text">
                <small class="text-muted">
                  <i class="fa-solid fa-location-dot"></i> {{ lesson.location }}<br>
                  <i class="fa-solid fa-tag"></i> £{{ lesson.price }}<br>
                  <i class="fa-solid fa-users"></i> Spaces: {{ lesson.space }}
                </small>
              </p>
              <!-- Add to Cart button -->
              <div class="d-grid mt-auto">
                <button class="btn btn-sm btn-success"
                        :disabled="lesson.space === 0"
                        @click="addToCart(lesson)">
                  <i class="fa-solid fa-cart-plus"></i> Add to Cart
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CART PAGE -->
      <div v-if="currentPage === 'cart'" class="container">
        <h2>Your Cart</h2>

        <!-- empty cart message -->
        <div v-if="cart.length === 0" class="alert alert-info">No items in cart.</div>

        <!-- cart items + checkout -->
        <div v-else>
          <div class="row">
            <div class="col-md-6 col-lg-4 mb-3"
                 v-for="(item, idx) in cart"
                 :key="idx">
              <div class="card">
                <div class="card-body">
                  <h6>{{ item.topic }} - £{{ item.price }}</h6>
                  <button class="btn btn-sm btn-outline-danger"
                          @click="removeFromCart(idx, item)">
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- checkout form -->
          <div class="mt-4 p-3 border rounded bg-light">
            <h5>Checkout</h5>
            <div class="row g-2">
              <div class="col-md-6">
                <input class="form-control form-control-sm"
                       placeholder="Name (letters only)"
                       v-model.trim="custName">
              </div>
              <div class="col-md-6">
                <input class="form-control form-control-sm"
                       placeholder="Phone (numbers only)"
                       v-model.trim="custPhone">
              </div>
            </div>
            <button class="btn btn-sm btn-primary mt-2"
                    :disabled="!validForm"
                    @click="checkout">
              Submit Order
            </button>
          </div>
        </div>

        <!-- success message -->
        <div v-if="orderMsg"
             class="alert alert-success alert-dismissible fade show d-block mt-2">
          {{ orderMsg }}
        </div>
      </div>

    </div>
  </div>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="app.js"></script>
</body>

</html>